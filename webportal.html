<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurityDB Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <style>
        /* Custom styles for a more security-focused look */
        body {
            background-color: #f8f9fa;
        }
        .card-header-custom {
            background-color: #343a40;
            color: white;
            border-bottom: 2px solid #28a745;
        }
        .severity-low { background-color: #007bff; color: white; }
        .severity-medium { background-color: #ffc107; color: #343a40; }
        .severity-high { background-color: #fd7e14; color: white; }
        .severity-critical { background-color: #dc3545; color: white; }
    </style>
</head>
<body>

    <div class="container mt-5">
        <header class="bg-dark text-white p-4 rounded-top d-flex justify-content-between align-items-center">
            <h1 class="h3 mb-0"><i class="bi bi-shield-fill-check text-success me-2"></i>SecurityDB Dashboard</h1>
            <p class="mb-0 text-muted">Web Simulation for Python/SQL Logic</p>
        </header>

        <ul class="nav nav-tabs bg-white p-2" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard-pane" type="button" role="tab">Dashboard</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="operations-tab" data-bs-toggle="tab" data-bs-target="#operations-pane" type="button" role="tab">Operations</button>
            </li>
        </ul>

        <div class="tab-content bg-white p-4 rounded-bottom shadow-sm" id="myTabContent">
            
            <div class="tab-pane fade show active" id="dashboard-pane" role="tabpanel">
                <h2 class="h4 mb-4">Current Risk Overview</h2>

                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <div class="card text-center bg-light border-primary">
                            <div class="card-body">
                                <i class="bi bi-server h2 text-primary"></i>
                                <h4 class="card-title" id="totalAssets">1</h4>
                                <p class="card-text text-primary">Total Assets</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center bg-light border-danger">
                            <div class="card-body">
                                <i class="bi bi-exclamation-triangle-fill h2 text-danger"></i>
                                <h4 class="card-title" id="totalVulns">0</h4>
                                <p class="card-text text-danger">Total Vulnerabilities</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center bg-light border-success">
                            <div class="card-body">
                                <i class="bi bi-database-check h2 text-success"></i>
                                <h4 class="card-title">Active</h4>
                                <p class="card-text text-success">DB Connection</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header card-header-custom">
                        <i class="bi bi-list-columns-reverse me-1"></i> Risk Report (Joined Data)
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Asset Name</th>
                                        <th>CVE Code</th>
                                        <th>Severity</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody id="riskReportTableBody">
                                    <tr><td colspan="4" class="text-center text-muted p-4">No vulnerabilities recorded yet.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <div class="tab-pane fade" id="operations-pane" role="tabpanel">
                <div class="row g-4">
                    
                    <div class="col-md-6">
                        <div class="card border-secondary">
                            <div class="card-header bg-secondary text-white"><i class="bi bi-server me-1"></i> Add Asset</div>
                            <div class="card-body">
                                <form id="addAssetForm">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">Asset Name *</label>
                                        <input type="text" class="form-control" id="assetName" required placeholder="e.g. Web-Server-01">
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <label class="form-label small text-muted">Type</label>
                                            <input type="text" class="form-control" id="assetType" placeholder="e.g. Server">
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small text-muted">IP Address *</label>
                                            <input type="text" class="form-control" id="assetIP" required placeholder="e.g. 10.0.0.5">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">Owner</label>
                                        <input type="text" class="form-control" id="assetOwner" placeholder="e.g. IT Dept">
                                    </div>
                                    <button type="submit" class="btn btn-dark w-100"><i class="bi bi-box-arrow-in-right me-1"></i> Run INSERT Asset</button>
                                </form>
                            </div>
                            <div class="card-footer bg-dark text-success small">
                                <p class="mb-1 text-uppercase text-muted">Current Assets (SELECT *)</p>
                                <div id="currentAssetsList" style="max-height: 150px; overflow-y: auto;">
                                    </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark"><i class="bi bi-exclamation-octagon-fill me-1"></i> Report Vulnerability</div>
                            <div class="card-body">
                                <form id="reportVulnForm">
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">Target Asset *</label>
                                        <select class="form-select" id="vulnAssetId" required>
                                            <option value="">Select an Asset...</option>
                                            </select>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-6">
                                            <label class="form-label small text-muted">CVE Code *</label>
                                            <input type="text" class="form-control" id="vulnCve" required placeholder="e.g. CVE-2023-1234">
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small text-muted">Severity</label>
                                            <select class="form-select" id="vulnSeverity">
                                                <option value="Low">Low</option>
                                                <option value="Medium">Medium</option>
                                                <option value="High">High</option>
                                                <option value="Critical">Critical</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted">Description</label>
                                        <input type="text" class="form-control" id="vulnDesc" placeholder="Brief description...">
                                    </div>
                                    <button type="submit" class="btn btn-warning w-100"><i class="bi bi-journal-plus me-1"></i> Run INSERT Vulnerability</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="liveToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body" id="toastBody">
            </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Data Simulation (Equivalent to your Python/SQL Data)
        let assets = [
            { id: 1, name: 'Main-Server-01', type: 'Linux Server', ip: '192.168.1.10', owner: 'Admin' }
        ];
        let vulnerabilities = [];

        // DOM Elements
        const totalAssetsEl = document.getElementById('totalAssets');
        const totalVulnsEl = document.getElementById('totalVulns');
        const riskReportTableBody = document.getElementById('riskReportTableBody');
        const currentAssetsList = document.getElementById('currentAssetsList');
        const vulnAssetSelect = document.getElementById('vulnAssetId');
        
        const liveToast = new bootstrap.Toast(document.getElementById('liveToast'));
        const toastBody = document.getElementById('toastBody');
        
        // --- Utility Functions ---

        function renderSeverityBadge(severity) {
            const lowerSev = severity.toLowerCase();
            return `<span class="badge ${'severity-' + lowerSev}">${severity}</span>`;
        }
        
        function updateDashboard() {
            // 1. Update Stat Cards
            totalAssetsEl.textContent = assets.length;
            totalVulnsEl.textContent = vulnerabilities.length;
            
            // 2. Update Risk Report Table
            if (vulnerabilities.length === 0) {
                riskReportTableBody.innerHTML = '<tr><td colspan="4" class="text-center text-muted p-4">No vulnerabilities recorded yet.</td></tr>';
            } else {
                riskReportTableBody.innerHTML = vulnerabilities.map(v => `
                    <tr>
                        <td>${v.assetName}</td>
                        <td class="font-monospace">${v.cve}</td>
                        <td>${renderSeverityBadge(v.severity)}</td>
                        <td>${v.desc}</td>
                    </tr>
                `).join('');
            }
            
            // 3. Update Asset Lists (Forms & Terminal View)
            let assetOptions = '<option value="">Select an Asset...</option>';
            let assetTerminalView = '';
            
            assets.forEach(a => {
                // For the dropdown list
                assetOptions += `<option value="${a.id}">${a.id} - ${a.name} (${a.ip})</option>`;
                // For the terminal-style list
                assetTerminalView += `
                    <div class="mb-1 text-monospace text-nowrap">
                        { id: ${a.id}, name: '${a.name}', ip: '${a.ip}' }
                    </div>
                `;
            });
            
            vulnAssetSelect.innerHTML = assetOptions;
            currentAssetsList.innerHTML = assetTerminalView || '<div class="text-muted fst-italic">No assets to display.</div>';
        }

        function showNotification(message, type = 'success') {
            let bgClass = '';
            if (type === 'success') {
                bgClass = 'bg-success';
            } else if (type === 'error') {
                bgClass = 'bg-danger';
            } else {
                bgClass = 'bg-info';
            }
            
            document.getElementById('liveToast').className = `toast align-items-center text-white border-0 ${bgClass}`;
            toastBody.textContent = message;
            liveToast.show();
        }
        
        // --- Event Handlers ---
        
        document.getElementById('addAssetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('assetName').value;
            const type = document.getElementById('assetType').value;
            const ip = document.getElementById('assetIP').value;
            const owner = document.getElementById('assetOwner').value;

            if (!name || !ip) {
                showNotification('Error: Name and IP are required.', 'error');
                return;
            }

            const newId = assets.length > 0 ? assets[assets.length - 1].id + 1 : 1;
            const asset = { id: newId, name, type, ip, owner };
            assets.push(asset);

            // Reset form
            this.reset();
            
            updateDashboard();
            showNotification('Asset added successfully!');
        });
        
        document.getElementById('reportVulnForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const assetId = document.getElementById('vulnAssetId').value;
            const cve = document.getElementById('vulnCve').value;
            const desc = document.getElementById('vulnDesc').value;
            const severity = document.getElementById('vulnSeverity').value;
            
            if (!assetId || !cve) {
                showNotification('Error: Asset and CVE are required.', 'error');
                return;
            }
            
            const targetAsset = assets.find(a => a.id === parseInt(assetId));
            const assetName = targetAsset ? targetAsset.name : 'Unknown';
            
            const newId = vulnerabilities.length > 0 ? vulnerabilities[vulnerabilities.length - 1].id + 1 : 1;
            const vuln = { id: newId, assetId: parseInt(assetId), assetName, cve, desc, severity };
            vulnerabilities.push(vuln);

            // Reset form
            this.reset();
            
            updateDashboard();
            showNotification('Vulnerability logged successfully!');
        });
        
        // Initial load of the dashboard
        document.addEventListener('DOMContentLoaded', updateDashboard);
        
    </script>

</body>
</html>